{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm run install-deps"
  },
  "deploy": {
    "startCommand": "node server.js",
    "healthcheckPath": "/health",
    "healthcheckTimeout": 30,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "nixpacks": {
    "config": {
      "phases": {
        "setup": {
          "nixPkgs": [
            "chromium",
            "curl",
            "wget",
            "python3",
            "py3-pip"
          ],
          "commands": [
            "pip3 install requests",
            "export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true",
            "export PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser"
          ]
        },
        "install": {
          "commands": [
            "export PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true",
            "export PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser",
            "npm run install-deps"
          ]
        }
      },
      "environment": {
        "NODE_ENV": "production",
        "PUPPETEER_SKIP_CHROMIUM_DOWNLOAD": "true",
        "PUPPETEER_EXECUTABLE_PATH": "/usr/bin/chromium-browser",
        "PROXY_TEST_URL": "https://httpbin.org/ip",
        "PORT": "3000"
      }
    }
  }
}
